<!DOCTYPE html>
<html>
<head>
    <title>Background Worker Test</title>
</head>
<body>
    <h1>Background Worker Test</h1>
    <button id="test">Test Connection</button>
    <pre id="result"></pre>

    <script>
        const result = document.getElementById('result');

        document.getElementById('test').addEventListener('click', async () => {
            result.textContent = 'Testing background connection...\n';

            if (typeof chrome === 'undefined' || !chrome.runtime) {
                result.textContent += '✗ Background NOT responding!\n';
                result.textContent += 'Error: chrome.runtime is not available.\n';
                result.textContent += 'This test must be run from a loaded extension context.\n';
                return;
            }

            try {
                const response = await chrome.runtime.sendMessage({ type: "PING" });

                if (response && response.type === 'PONG') {
                    result.textContent += `✓ Background responded!\n`;
                    result.textContent += `  - Version: ${response.version}\n`;
                    result.textContent += `  - Uptime: ${response.uptime}s\n`;
                } else {
                    result.textContent += '✗ Background NOT responding!\n';
                    result.textContent += 'Error: Unexpected response.\n';
                    result.textContent += JSON.stringify(response, null, 2);
                }
            } catch (err) {
                result.textContent += '✗ Background NOT responding!\n';
                result.textContent += err.message + '\n';
                result.textContent += 'This means the service worker is inactive/crashed.\n';
                result.textContent += 'Go to chrome://extensions/ and click "service worker"';
            }
        });

        // Auto-test on load
        document.getElementById('test').click();
    </script>
</body>
</html>
